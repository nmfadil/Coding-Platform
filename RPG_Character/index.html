<!--
This project is inspired by FreeCodeCamp's Python Lab examples.
Original content can be found at: https://www.freecodecamp.org/
-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python Lab: RPG Character</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/theme/dracula.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/python/python.min.js"></script>
    
    <script src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js"></script>

    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; background-color: #1e1e1e; color: #ddd; }
        header { background: #2d2d2d; padding: 10px 20px; border-bottom: 1px solid #444; display: flex; justify-content: space-between; align-items: center; }
        h1 { margin: 0; font-size: 1.2rem; color: #61dafb; }
        
        .container { display: flex; flex: 1; overflow: hidden; }
        
        /* Columns */
        .col { flex: 1; display: flex; flex-direction: column; border-right: 1px solid #444; min-width: 0; }
        .col:last-child { border-right: none; }
        
        /* Headers */
        .panel-header { background: #333; padding: 8px 15px; font-weight: bold; font-size: 0.9rem; border-bottom: 1px solid #444; }
        
        /* Content Areas */
        .scrollable { flex: 1; overflow-y: auto; padding: 20px; }
        #editor-container { flex: 1; position: relative; font-size: 14px; }
        .CodeMirror { height: 100%; }
        
        /* Instructions Styling */
        .instructions h3 { color: #fff; border-bottom: 1px solid #555; padding-bottom: 5px; }
        .instructions code { background: #333; padding: 2px 4px; border-radius: 3px; font-family: monospace; color: #ff79c6; }
        .instructions ul { padding-left: 20px; }
        .instructions li { margin-bottom: 5px; }
        
        /* Output & Console */
        #output { background: #151515; color: #eee; font-family: 'Consolas', monospace; padding: 15px; white-space: pre-wrap; flex: 1; border-bottom: 1px solid #444; overflow-y: auto; }
        #test-results { background: #1a1a1a; height: 40%; padding: 15px; overflow-y: auto; font-family: 'Consolas', monospace; }
        
        .pass { color: #50fa7b; }
        .fail { color: #ff5555; }
        .info { color: #8be9fd; }

        /* Buttons */
        .btn-group { display: flex; gap: 10px; }
        button { padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; transition: background 0.2s; }
        #run-btn { background: #50fa7b; color: #000; }
        #run-btn:hover { background: #40c963; }
        #submit-btn { background: #bd93f9; color: #000; }
        #submit-btn:hover { background: #a57ee6; }
        button:disabled { opacity: 0.5; cursor: not-allowed; }

        /* Loader */
        #loader { display: none; color: #f1fa8c; margin-right: 15px; font-size: 0.9rem; }
    </style>
</head>
<body>

<header>
    <div style="display:flex; align-items:center">
        <h1>RPG Character Lab</h1>
        <span id="loader">Initializing Python Environment...</span>
    </div>
    <div class="btn-group">
        <button id="run-btn" onclick="runCode()" disabled>â–¶ Run Code</button>
        <button id="submit-btn" onclick="submitTests()" disabled>âœ“ Submit & Test</button>
    </div>
</header>

<div class="container">
    <div class="col instructions">
        <div class="panel-header">Instructions</div>
        <div class="scrollable"><!--
            <h3>Objective</h3>
            <p>Create a function named <code>create_character</code> that creates an RPG character string based on validated inputs.</p>
            
            <h3>Parameters</h3>
            <ol>
                <li><code>name</code> (string)</li>
                <li><code>strength</code> (int)</li>
                <li><code>intelligence</code> (int)</li>
                <li><code>charisma</code> (int)</li>
            </ol>

            <h3>Validation Rules</h3>
            <ul>
                <li><strong>Name:</strong> Must be a string, not empty, max 10 chars, no spaces.</li>
                <li><strong>Stats:</strong> Must be integers, range 1-4.</li>
                <li><strong>Total Stats:</strong> Must sum exactly to 7.</li>
            </ul>

            <h3>Return Value</h3>
            <p>If invalid, return the specific error message (e.g., "The character name should be a string").</p>
            <p>If valid, return a formatted string like:</p>
            <pre style="background:#000; padding:10px; border-radius:5px;">ren
STR â—â—â—â—â—‹â—‹â—‹â—‹â—‹â—‹
INT â—â—â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹
CHA â—â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹</pre>
            <p><em>Use these dots:</em> Full: <code>â—</code> Empty: <code>â—‹</code></p>
        -->
            <p>In this lab you will practice the basics of Python by building a small app that creates a character for an RPG adventure.</p>
<p><strong>Objective:</strong> Fulfill the user stories below and get all the tests to pass to complete the lab.</p>
<p><strong>User Stories:</strong></p>
<ol>
<li>You should have a function named <code>create_character</code>.</li>
<li>The function should accept, in order, a character name followed by three stats: strength, intelligence, and charisma.</li>
<li>The character name should be validated:<ul>
<li>If the character name is not a string, the function should return <code>The character name should be a string</code>.</li>
<li>If the character name is an empty string, the function should return <code>The character should have a name</code>.</li>
<li>If the character name is longer than 10 characters, the function should return <code>The character name is too long</code>.</li>
<li>If the character name contains spaces, the function should return <code>The character name should not contain spaces</code>.</li>
</ul>
</li>
<li>The stats should also be validated:<ul>
<li>If one or more stats are not integers, the function should return <code>All stats should be integers</code>.</li>
<li>If one or more stats are less than 1, the function should return <code>All stats should be no less than 1</code>.</li>
<li>If one or more stats are more than 4, the function should return <code>All stats should be no more than 4</code>.</li>
<li>If the sum of all stats is different than 7, the function should return <code>The character should start with 7 points</code>.</li>
</ul>
</li>
<li>If all values pass the verification, the function should return a string with four lines:<ul>
<li>the first line should contain the character name</li>
<li>lines 2-4 should start with the stat abbreviation, <code>STR</code>, <code>INT</code> or <code>CHA</code> (in this order), then a space, and then a number of full dots (<code>â—</code>) equal to the value of the stat, and a number of empty dots (<code>â—‹</code>) to reach 10. Example: if the value of strength is 3 there must be 3 full dots followed by 7 empty dots. The dots are given in the editor.</li>
</ul>
</li>
</ol>
<p>Here's the string that should be returned by <code>create_character(&#39;ren&#39;, 4, 2, 1)</code>:</p>
<!-- <pre><code>ren
<span class="hljs-keyword">STR</span> â—â—â—â—â—‹â—‹â—‹â—‹â—‹â—‹
<span class="hljs-keyword">INT</span> â—â—â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹
CHA â—â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹
</code></pre> -->

            <pre style="background:#000; padding:10px; border-radius:5px;">ren
STR â—â—â—â—â—‹â—‹â—‹â—‹â—‹â—‹
INT â—â—â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹
CHA â—â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹</pre>
<p>NOTE: while <code>str</code> and <code>int</code> are common abbreviations for the stats, remember that those are reserved keywords in Python and should not be used as variable names.</p>
<h3> Tests</h3>
<ol>
<li><p>You should have a function named <code>create_character</code>.</p>
</li>
<li><p>When <code>create_character</code> is called with a first argument that is not a string it should return <code>The character name should be a string</code>.</p>
</li>
<li><p>When <code>create_character</code> is called with a first argument that is an empty string, it should return <code>The character should have a name</code>.</p>
</li>
<li><p>When <code>create_character</code> is called with a first argument that is longer than 10 characters it should return <code>The character name is too long</code>.</p>
</li>
<li><p>The <code>create_character</code> function should not say that the character is too long when it&#39;s not longer than 10 characters.</p>
</li>
<li><p>When <code>create_character</code> is called with a first argument that contains a space it should return <code>The character name should not contain spaces</code>.</p>
</li>
<li><p>When <code>create_character</code> is called with a second, third or fourth argument that is not an integer it should return <code>All stats should be integers</code>.</p>
</li>
<li><p>When <code>create_character</code> is called with a second, third or fourth argument that is lower than <code>1</code> it should return <code>All stats should be no less than 1</code>.</p>
</li>
<li><p>When <code>create_character</code> is called with a second, third or fourth argument that is higher than <code>4</code> it should return <code>All stats should be no more than 4</code>.</p>
</li>
<li><p>When <code>create_character</code> is called with a second, third or fourth argument that do not sum to <code>7</code> it should return <code>The character should start with 7 points</code>.</p>
</li>
<li><p><code>create_character(&#39;ren&#39;, 4, 2, 1)</code> should return <code>ren\nSTR â—â—â—â—â—‹â—‹â—‹â—‹â—‹â—‹\nINT â—â—â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹\nCHA â—â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹</code>.</p>
</li>
<li><p>When <code>create_character</code> is called with valid values it should output the character stats as required.</p>
</li>
</ol>

        </div>
    </div>

    <div class="col">
        <div class="panel-header">main.py</div>
        <div id="editor-container"></div>
    </div>

    <div class="col">
        <div class="panel-header">Console Output</div>
        <div id="output">Hit "Run" to execute your code...</div>
        <div class="panel-header">Test Results</div>
        <div id="test-results"><span class="info">Waiting for submission...</span></div>
    </div>
</div>

<script>
    // 1. Initialize CodeMirror Editor
    var editor = CodeMirror(document.getElementById("editor-container"), {
        mode: "python",
        theme: "dracula",
        lineNumbers: true,
        indentUnit: 4,
        /* value: `# Write your function below
def create_character(name, strength, intelligence, charisma):
    # Your logic here
    pass


# You can test your function manually here
# print(create_character('ren', 4, 2, 1))
` */
value: `full_dot = 'â—'
empty_dot = 'â—‹'

`
    });

    // 2. Initialize Pyodide
    let pyodide;
    const outputDiv = document.getElementById("output");
    const testDiv = document.getElementById("test-results");
    const loader = document.getElementById("loader");
    const runBtn = document.getElementById("run-btn");
    const subBtn = document.getElementById("submit-btn");

    async function main() {
        loader.style.display = "block";
        pyodide = await loadPyodide();
        loader.style.display = "none";
        runBtn.disabled = false;
        subBtn.disabled = false;
        console.log("Pyodide ready");
    }
    main();

    // 3. Output Handling
    function addToOutput(s) {
        outputDiv.innerText += s + "\n";
        outputDiv.scrollTop = outputDiv.scrollHeight;
    }

    // 4. Run Code Function
    async function runCode() {
        outputDiv.innerText = ""; // Clear output
        let code = editor.getValue();
        
        try {
            // Redirect Python print statements to our JS function
            pyodide.setStdout({ batched: (msg) => addToOutput(msg) });
            await pyodide.runPythonAsync(code);
        } catch (err) {
            addToOutput(err);
        }
    }

    // 5. Submit & Test Function
    async function submitTests() {
        testDiv.innerHTML = "<span class='info'>Running tests...</span><br>";
        outputDiv.innerText = ""; // Clear output
        let userCode = editor.getValue();
        
        // This python script contains the user code + the test suite
        // We wrap it in a try/except block in Python to handle errors gracefully
        let testSuite = `
${userCode}

results = []

def run_test(desc, passed, message=""):
    status = "PASS" if passed else "FAIL"
    results.append(f"{status}|{desc}|{message}")

try:
    # Check if function exists
    if 'create_character' not in locals():
        run_test("Function Existence", False, "Function 'create_character' not found")
    else:
        # 0. Function check
        run_test("Function Existence", True, "Function 'create_character' is found")

        # 1. Type validation
        res = create_character(123, 1, 1, 1)
        run_test("Name Type Check", res == "The character name should be a string", f"Got: {res}")

        # 2. Empty string
        res = create_character("", 1, 1, 1)
        run_test("Empty Name Check", res == "The character should have a name", f"Got: {res}")

        # 3. Length check
        res = create_character("abcdefghijk", 1, 1, 1)
        run_test("Name Length Check", res == "The character name is too long", f"Got: {res}")

        # 4. Valid Length check (boundary)
        res = create_character("abcdefghij", 4, 2, 1) # valid 10 chars
        if res == "The character name is too long.":
            run_test("Valid Name Length", False, "Reported too long for valid length")
        else:
            run_test("Valid Name Length", True)

        # 5. Space check
        res = create_character("John Doe", 1, 1, 1)
        run_test("No Spaces Check", res == "The character name should not contain spaces", f"Got: {res}")

        # 6. Stats Integers
        res = create_character("ren", "4", 2, 1)
        run_test("Stats Type Check", res == "All stats should be integers", f"Got: {res}")

        # 7. Low Stats
        res = create_character("ren", 0, 3, 4)
        run_test("Min Stats Check", res == "All stats should be no less than 1", f"Got: {res}")

        # 8. High Stats
        res = create_character("ren", 5, 1, 1)
        run_test("Max Stats Check", res == "All stats should be no more than 4", f"Got: {res}")

        # 9. Sum Check
        res = create_character("ren", 1, 1, 1) # sum 3
        run_test("Sum Stats Check", res == "The character should start with 7 points", f"Got: {res}")

        # 10. Happy Path
        expected = "ren\\nSTR â—â—â—â—â—‹â—‹â—‹â—‹â—‹â—‹\\nINT â—â—â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹\\nCHA â—â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹"
        actual = create_character('ren', 4, 2, 1)
        run_test("Output Formatting", actual == expected, "Output did match format")

except Exception as e:
    run_test("Execution Error", False, str(e))

# Return results as a list of strings
results
`;

        try {
            let resultsProxy = await pyodide.runPythonAsync(testSuite);
            let results = resultsProxy.toJs();
            
            testDiv.innerHTML = ""; // Clear previous results
            let allPassed = true;

            results.forEach(r => {
                let [status, desc, msg] = r.split("|");
                let colorClass = status === "PASS" ? "pass" : "fail";
                let icon = status === "PASS" ? "âœ“" : "âœ—";
                if(status === "FAIL") allPassed = false;
                
                let html = `<div class="${colorClass}"><strong>${icon} ${desc}</strong>`;
                if(msg) html += `<br><small style="color:#aaa; margin-left:15px;">${msg}</small>`;
                html += `</div>`;
                testDiv.innerHTML += html;
            });

            if(allPassed) {
                testDiv.innerHTML += `<div style="margin-top:10px; padding:10px; background:#2d5e30; color:white; text-align:center;">ğŸ‰ CONGRATULATIONS! ALL TESTS PASSED. ğŸ‰</div>`;
            }

        } catch (err) {
            testDiv.innerHTML = `<div class="fail"><strong>Syntax/Runtime Error:</strong><br>${err}</div>`;
        }
    }
</script>

</body>
</html>
